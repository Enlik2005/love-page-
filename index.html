<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ üíå</title>

  <style>
    :root{
      --bg1:#ffe7f2;
      --bg2:#ffd3e8;
      --card:#ffffffcc;
      --stroke: rgba(255, 79, 163, .25);
      --text:#3b1b2a;
      --muted:#7a3a56;
      --accent1:#ff4fa3;
      --accent2:#ff93c8;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background:
        radial-gradient(900px 600px at 30% 15%, #fff, transparent 60%),
        radial-gradient(900px 600px at 70% 20%, #fff, transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      overflow:hidden;
    }
    .bg-hearts{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.14;
      background:
        radial-gradient(circle at 12% 18%, #ff6fb8 0 6px, transparent 7px),
        radial-gradient(circle at 40% 12%, #ff6fb8 0 5px, transparent 6px),
        radial-gradient(circle at 78% 24%, #ff6fb8 0 7px, transparent 8px),
        radial-gradient(circle at 70% 72%, #ff6fb8 0 6px, transparent 7px),
        radial-gradient(circle at 25% 76%, #ff6fb8 0 7px, transparent 8px);
      animation: floatBg 10s ease-in-out infinite;
      filter: blur(.2px);
    }
    @keyframes floatBg{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(10px); }
    }

    .card{
      width:min(92vw, 460px);
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: 26px;
      padding: 22px;
      box-shadow: 0 18px 60px rgba(255,79,163,.18);
      text-align:center;
      position:relative;
      backdrop-filter: blur(8px);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-weight:900;
      font-size: 12px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px dashed rgba(255,79,163,.35);
      background: rgba(255,255,255,.72);
      color: rgba(59,27,42,.9);
      margin-bottom: 10px;
    }

    h1{ margin: 6px 0 8px; font-size: 22px; }
    p{ margin: 0 0 14px; color: var(--muted); font-size: 14px; line-height: 1.35; }

    .controls{ margin-top: 10px; }

    .btn{
      border:0;
      border-radius: 16px;
      padding: 14px 18px;
      font-size: 16px;
      font-weight: 900;
      cursor: pointer;
      user-select:none;
      transition: transform .08s ease, filter .12s ease, left .18s ease, top .18s ease;
      will-change: transform, left, top;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active{ transform: scale(.98); }

    #yes{
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      color: #fff;
      box-shadow: 0 14px 28px rgba(255,79,163,.28);
      margin-bottom: 10px;
    }

    .arena{
      position:relative;
      height: 230px;
      border-radius: 22px;
      background: rgba(255,255,255,.55);
      border: 1px dashed rgba(255,79,163,.32);
      overflow:hidden;
      touch-action: manipulation;
    }

    #no{
      position:absolute;
      left: 55%;
      top: 60%;
      transform: translate(-50%,-50%);
      background: rgba(255,255,255,.88);
      color: rgba(59,27,42,.95);
      border: 1px solid rgba(255,79,163,.35);
      box-shadow: 0 10px 18px rgba(255,79,163,.14);
      backdrop-filter: blur(6px);
    }

    .panic{
      animation: panic .12s linear 2;
      filter: saturate(1.2);
    }
    @keyframes panic{
      0%{ transform: translate(var(--tx), var(--ty)) rotate(0deg) scale(1); }
      25%{ transform: translate(calc(var(--tx) + 2px), calc(var(--ty) - 2px)) rotate(-2deg) scale(1.02); }
      50%{ transform: translate(calc(var(--tx) - 2px), calc(var(--ty) + 2px)) rotate(2deg) scale(0.98); }
      75%{ transform: translate(calc(var(--tx) + 2px), calc(var(--ty) + 2px)) rotate(-2deg) scale(1.02); }
      100%{ transform: translate(var(--tx), var(--ty)) rotate(0deg) scale(1); }
    }

    .taunt{
      display:none;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,79,163,.25);
      background: rgba(255,255,255,.75);
      color: rgba(59,27,42,.95);
      font-weight: 900;
      font-size: 13px;
    }

    /* —Ñ–∏–Ω–∞–ª */
    .result{ display:none; margin-top: 14px; }
    .result img{
      width: 100%;
      max-width: 340px;
      border-radius: 22px;
      border: 1px solid rgba(255,79,163,.25);
      box-shadow: 0 18px 48px rgba(255,79,163,.18);
    }
    .caption{
      margin-top: 10px;
      font-size: 18px;
      font-weight: 1000;
      color: rgba(59,27,42,.95);
    }
    .tiny{
      margin-top: 8px;
      font-size: 12px;
      color: rgba(122,58,86,.85);
    }

    /* —Å–µ—Ä–¥–µ—á–∫–∏ */
    canvas#hearts{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index: 9999;
      display:none;
    }

    /* –º–æ–¥–∞–ª–∫–∞ */
    .modal-backdrop{
      position:fixed; inset:0;
      display:none;
      place-items:center;
      background: rgba(0,0,0,.25);
      z-index: 10000;
      padding: 18px;
    }
    .modal{
      width:min(92vw, 420px);
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(255,79,163,.25);
      border-radius: 22px;
      box-shadow: 0 24px 60px rgba(0,0,0,.18);
      padding: 16px;
      text-align:center;
    }
    .modal h2{
      margin: 6px 0 8px;
      font-size: 18px;
      color: rgba(59,27,42,.95);
    }
    .modal p{
      margin: 0 0 12px;
      color: rgba(122,58,86,.95);
      font-size: 13px;
    }
    .modal-actions{
      display:flex;
      gap:10px;
      justify-content:center;
    }
    .mbtn{
      border:0;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 900;
      cursor:pointer;
    }
    .m-yes{
      background: linear-gradient(135deg, var(--accent1), var(--accent2));
      color:#fff;
    }
    .m-no{
      background: rgba(255,255,255,.9);
      border: 1px solid rgba(255,79,163,.3);
      color: rgba(59,27,42,.95);
    }
  </style>
</head>

<body>
  <div class="bg-hearts"></div>
  <canvas id="hearts"></canvas>

  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <h2 id="modalTitle">–¢—ã —Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω–∞? üôÇ</h2>
      <p id="modalText">–ù—É –ø–æ–¥—É–º–∞–π –µ—â—ë —Ä–∞–∑–æ—á–µ–∫‚Ä¶</p>
      <div class="modal-actions">
        <button class="mbtn m-yes" id="modalYes">–î–∞</button>
        <button class="mbtn m-no" id="modalNo">–ù–µ—Ç</button>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="badge">For Mereyüíå</div>

    <div id="questionBlock">
      <h1>–¢—ã –±—É–¥–µ—à—å –º–æ–µ–π –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π?üëâüëà</h1>
      <p>–¢–æ–ª—å–∫–æ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–∂–∞—Ç—å ¬´–ù–µ—Ç¬ªüòà</p>

      <div class="controls">
        <button class="btn" id="yes">–î–∞üíñ</button>
      </div>

      <div class="arena" id="arena">
        <button class="btn" id="no">–ù–µ—ÇüôÉ</button>
      </div>

      <div class="taunt" id="taunt"></div>
    </div>

    <div class="result" id="result">
      <img id="gif" alt="gif" />
      <div class="caption">–£—Ä–∞–∞–∞, —Ç–µ–ø–µ—Ä—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ: —Ç—ã –º–æ—è –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ üíå üíû</div>
      <div class="tiny"> –¢—ã —Å–∞–º–∞—è –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞—è –¥–µ–≤—É—à–∫–∞ –∫–æ—Ç–æ—Ä—É—é —è –≤—Å—Ç—Ä–µ—á–∞–ª </div>
    </div>
  </div>

  <script>
    // ===== –ù–ê–°–¢–†–û–ô–ö–ò =====
    const GIF_URL = "https://media.giphy.com/media/MDJ9IbxxvDUQM/giphy.gif";

    const TRIGGER_RADIUS = 160;
    const EVASION_DISTANCE = 190;
    const TELEPORT_CHANCE = 0.35;
    const SHRINK_CHANCE = 0.25;
    const SPIN_CHANCE = 0.20;
    const TEXTS = ["–ù–µ—ÇüôÉ","–ù–µ–µ–µ—Çüòà","–ù–µ –ø–æ–π–º–∞–µ—à—åüòù","–ú–∏–º–æüíÖ","–•–∞—Ö–∞üòè","–ù–µ–∞ü´∂"];
    // =====================

    const arena = document.getElementById('arena');
    const noBtn = document.getElementById('no');
    const yesBtn = document.getElementById('yes');

    const questionBlock = document.getElementById('questionBlock');
    const result = document.getElementById('result');
    const gif = document.getElementById('gif');
    const taunt = document.getElementById('taunt');

    // –º–æ–¥–∞–ª–∫–∞
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalTitle = document.getElementById('modalTitle');
    const modalText = document.getElementById('modalText');
    const modalYes = document.getElementById('modalYes');
    const modalNo = document.getElementById('modalNo');

    let noAttempts = 0;
    let modalStep = 0; // 1,2...

    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

    function panicAnim(){
      noBtn.classList.remove("panic");
      void noBtn.offsetWidth;
      noBtn.classList.add("panic");
    }

    function spiceNo(){
      noBtn.textContent = TEXTS[Math.floor(Math.random()*TEXTS.length)];
      if (Math.random() < SHRINK_CHANCE){
        noBtn.style.transform = "scale(0.86)";
        setTimeout(() => { noBtn.style.transform = "none"; }, 170);
      }
      if (Math.random() < SPIN_CHANCE){
        noBtn.style.transform = "rotate(" + (Math.random()<0.5 ? "-" : "") + "12deg)";
        setTimeout(() => { noBtn.style.transform = "none"; }, 170);
      }
    }

    function setNoPos(x,y){
      noBtn.style.left = x + "px";
      noBtn.style.top  = y + "px";
      noBtn.style.transform = "none";
      noBtn.style.setProperty("--tx","0px");
      noBtn.style.setProperty("--ty","0px");
    }

    function randomPos(){
      const pad = 10;
      const a = arena.getBoundingClientRect();
      const b = noBtn.getBoundingClientRect();
      const maxX = a.width  - b.width  - pad;
      const maxY = a.height - b.height - pad;
      return { x: Math.random()*maxX + pad, y: Math.random()*maxY + pad, a, b };
    }

    function evade(clientX, clientY){
      // –µ—Å–ª–∏ —É–∂–µ –ø–æ—à–ª–∏ –º–æ–¥–∞–ª–∫–∏ ‚Äî –Ω–µ –º–µ—à–∞–µ–º
      if (modalBackdrop.style.display === "grid") return;

      const a = arena.getBoundingClientRect();
      const b = noBtn.getBoundingClientRect();

      const btnCenterX = (b.left - a.left) + b.width/2;
      const btnCenterY = (b.top  - a.top ) + b.height/2;

      const px = clientX - a.left;
      const py = clientY - a.top;

      const dx = btnCenterX - px;
      const dy = btnCenterY - py;

      const dist = Math.hypot(dx, dy) || 1;
      if (dist > TRIGGER_RADIUS) return;

      const ux = dx / dist;
      const uy = dy / dist;

      let targetX = (btnCenterX + ux * EVASION_DISTANCE) - b.width/2;
      let targetY = (btnCenterY + uy * EVASION_DISTANCE) - b.height/2;

      if (Math.random() < TELEPORT_CHANCE){
        targetX = (a.width  - (b.left - a.left) - b.width);
        targetY = (a.height - (b.top  - a.top ) - b.height);
      }

      const pad = 8;
      targetX = clamp(targetX, pad, a.width  - b.width  - pad);
      targetY = clamp(targetY, pad, a.height - b.height - pad);

      spiceNo();
      panicAnim();
      setNoPos(targetX, targetY);
    }

    function openModal(step){
      modalStep = step;
      modalBackdrop.style.display = "grid";

      if (step === 1){
        modalTitle.textContent = "–¢—ã —Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω–∞? üôÇ";
        modalText.textContent = "–ü–æ–¥—É–º–∞–π—Ç–µ –µ—â–µ —Ä–∞–∑–æ—á–µ–∫‚Ä¶";
      } else if (step === 2){
        modalTitle.textContent = "–¢–æ—á–Ω–æ-—Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω–∞? ü•∫";
        modalText.textContent = "–ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å";
      }
    }

    function closeModal(){
      modalBackdrop.style.display = "none";
    }

    function showTaunt(){
      taunt.style.display = "block";
      taunt.textContent = "–ü—Ñ, —Ä–∞–∑–º–µ—á—Ç–∞–ª–∞—Å—å üòå –í—ã–±–æ—Ä–∞ –Ω–µ—Ç, –Ω–∞–∂–∏–º–∞–π –Ω–∞ ¬´–î–∞¬ª";
      spiceNo();
      panicAnim();
      const {x,y} = randomPos();
      setNoPos(x,y);
    }

    function showFinal(){
      questionBlock.style.display = "none";
      gif.src = GIF_URL;
      result.style.display = "block";
      startHearts();
    }

    // –º–æ–¥–∞–ª–∫–∞ –∫–Ω–æ–ø–∫–∏
    modalYes.addEventListener("click", () => {
      closeModal();
      showFinal();
    });

    modalNo.addEventListener("click", () => {
      if (modalStep === 1){
        openModal(2);
        return;
      }
      // –≤—Ç–æ—Ä–æ–π —Ä–∞–∑ –Ω–∞–∂–∞–ª–∏ "–ù–µ—Ç" –≤ –º–æ–¥–∞–ª–∫–∞—Ö
      closeModal();
      showTaunt();
    });

    yesBtn.addEventListener("click", showFinal);

    // —É–±–µ–≥–∞–Ω–∏–µ –∑–∞—Ä–∞–Ω–µ–µ
    arena.addEventListener("mousemove", (e) => evade(e.clientX, e.clientY));
    arena.addEventListener("touchmove", (e) => {
      const t = e.touches[0];
      evade(t.clientX, t.clientY);
    }, { passive:true });

    // –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞–∂–∞—Ç—å "–ù–µ—Ç" ‚Äî —Å—á–∏—Ç–∞–µ–º –Ω–∞ pointerdown (—Å–∞–º—ã–π —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
    noBtn.addEventListener("pointerdown", (e) => {
      e.preventDefault();
      if (modalBackdrop.style.display === "grid") return;

      noAttempts++;

      if (noAttempts >= 5){
        openModal(1);
        return;
      }

      // –æ–±—ã—á–Ω–æ–µ —É–±–µ–≥–∞–Ω–∏–µ
      spiceNo();
      panicAnim();
      const {x,y} = randomPos();
      setNoPos(x,y);
    }, { passive:false });

    // —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
    const start = randomPos();
    setNoPos(start.x, start.y);

    // ===== –°–µ—Ä–¥–µ—á–∫–∏ Canvas =====
    const canvas = document.getElementById("hearts");
    const ctx = canvas.getContext("2d");
    let pieces = [];
    let animId = null;

    function resize() {
      canvas.width = window.innerWidth * devicePixelRatio;
      canvas.height = window.innerHeight * devicePixelRatio;
      ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
    }
    window.addEventListener("resize", resize);
    resize();

    function heartPath(x, y, size) {
      ctx.beginPath();
      const top = size * 0.3;
      ctx.moveTo(x, y + top);
      ctx.bezierCurveTo(x, y, x - size/2, y, x - size/2, y + top);
      ctx.bezierCurveTo(x - size/2, y + (size + top)/2, x, y + (size + top)/1.2, x, y + size);
      ctx.bezierCurveTo(x, y + (size + top)/1.2, x + size/2, y + (size + top)/2, x + size/2, y + top);
      ctx.bezierCurveTo(x + size/2, y, x, y, x, y + top);
      ctx.closePath();
    }

    function makeHearts(count=160) {
      pieces = Array.from({length: count}, () => ({
        x: Math.random() * window.innerWidth,
        y: -20 - Math.random() * 400,
        s: 10 + Math.random() * 14,
        vx: -0.8 + Math.random() * 1.6,
        vy: 1.8 + Math.random() * 3.2,
        a: 0.55 + Math.random() * 0.35
      }));
    }

    function drawHearts() {
      ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);

      for (const p of pieces) {
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.006;

        ctx.save();
        ctx.globalAlpha = p.a;
        ctx.fillStyle = "rgba(255, 79, 163, 0.95)";
        heartPath(p.x, p.y, p.s);
        ctx.fill();
        ctx.restore();

        if (p.y > window.innerHeight + 60) {
          p.y = -30 - Math.random() * 200;
          p.x = Math.random() * window.innerWidth;
          p.vy = 1.8 + Math.random() * 3.2;
        }
      }
      animId = requestAnimationFrame(drawHearts);
    }

    function startHearts() {
      canvas.style.display = "block";
      makeHearts(170);
      if (!animId) drawHearts();
    }
  </script>
</body>
</html>
